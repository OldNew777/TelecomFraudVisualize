<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>刑期热力图</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <style>
      .cell {
        stroke: #fff;
      }
      .cell:hover {
        stroke: #f00;
        stroke-width: 2px;
      }
      .tooltip {
        position: absolute;
        z-index: 10;
        visibility: hidden;
        background-color: white;
        border: 1px solid black;
        padding: 5px;
      }
      .legend {
        font-size: 12px;
        fill: #da0d0d;
      }
    </style>
  </head>
  <body>
    <script>
      const xValues = [0.0,0.5,1.0,1.5,2.0,2.5,3.0,3.5,4.0,4.5,5.0,5.5,6.0,6.5,7.0,7.5,8.0,8.5,9.0,9.5,10.0,10.5,11.0,11.5,12.0,12.5,13.0,13.5,14.0,14.5,15.0,15.5,16.0,16.5,17.0,17.5,18.0,18.5,19.0,19.5,20.0,20.5,21.0,21.5,22.0,22.5,23.0,23.5,24.0,24.5,25.0,25.5,26.0,26.5,27.0,27.5,28.0,28.5,29.0,29.5,30.0,30.5];
      const data = [0,0,2326,5365,1703,2742,2693,3698,1308,1773,909,982,525,584,370,367,206,247,118,96,543,877,199,164,173,131,121,106,45,51,30,11,5,3,0,5,0,1,1,0,77,172,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,2,8];
      
      // 定义画布大小和边距
      const margin = {top: 20, right: 20, bottom: 50, left: 50};
      const width = 1500 - margin.left - margin.right;
      const height = 1000 - margin.top - margin.bottom;

      // 定义颜色比例尺
      const color = d3.scaleSequential(d3.interpolateReds)
        .domain([0, d3.max(data)]);

      // 定义x比例尺和轴
      const x = d3.scaleBand()
        .domain(xValues)
        .range([0, width])
        .padding(0.1);
      const xAxis = d3.axisBottom(x);

      // 创建svg元素并添加到页面中
      const svg = d3.select("body").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      // 绘制矩形和添加交互效果
      svg.selectAll(".cell")
        .data(data)
        .enter().append("rect")
        .attr("class", "cell")
        .attr("x", (d, i) => x(xValues[i]))
        .attr("y", 0)
        .attr("width", width / data.length)
        .attr("height", height)
        .attr("fill", d => color(d))
        .on("mouseover", function(d, i) { // 鼠标移上去显示tooltip
          d3.select(this).style("stroke-width", 2);
          d3.select(".tooltip")
            .style("visibility", "visible")
            .style("white-space", "pre")
            .text(`刑期 ${i/2} \n人数 ${d}`)
            .style("top", (d3.event.pageY-10)+"px")
            .style("left",(d3.event.pageX+10)+"px");
        })
        .on("mouseout", function() { // 鼠标移开隐藏tooltip
          d3.select(this).style("stroke-width", 1);
          d3.select(".tooltip").style("visibility", "hidden");
        });

      // 添加x轴
      svg.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + height + ")")
        .call(xAxis);

      // 添加图例
      const legend = svg.selectAll(".legend")
        .data(color.ticks(8).slice(1).reverse())
        .enter().append("g")
        .attr("class", "legend")
        .attr("transform", (d, i) => "translate(0," + (i * 20) + ")");

      legend.append("rect")
        .attr("x", width + 10)
        .attr("width", 18)
        .attr("height", 18)
        .style("fill", color);

      legend.append("text")
        .attr("x", width + 34)
        .attr("y", 9)
        .attr("dy", ".35em")
        .text(d => d.toFixed(2));

      // 添加tooltip元素
      d3.select("body").append("div")
        .attr("class", "tooltip");
    </script>
  </body>
</html>
